(()=>{"use strict";class e{constructor(e,t,s,i,r,n,o){this._text=e.name,this._link=e.link,this.id=e._id,this._owherId=e.owner._id,this._userId=o,this._likesArr=e.likes,this._templateSelector=t,this._handleCardImage=s,this.likeHandler=i,this.dislikeHandler=r,this.deleteHandler=n,this.isLiked=!1}isMyLiked(){this._likesArr.forEach((e=>{e._id==this._userId&&(this.isLiked=!0,this.likeButton.classList.toggle("cards-grid__like-button_active"))}))}_getTemplate(){return document.getElementById(this._templateSelector).content.cloneNode(!0)}generateCard(){return this._element=this._getTemplate(),this._image=this._element.querySelector(".cards-grid__image"),this._image.src=this._link,this._image.alt=this._text,this._element.querySelector(".cards-grid__text").textContent=this._text,this.likeButton=this._element.querySelector(".cards-grid__like-button"),this._deleteButton=this._element.querySelector(".cards-grid__trash-button"),this._userId!==this._owherId&&this._deleteButton.classList.add("cards-grid__trash-button_disabled"),this._setEventListeners(),this.likesHTML=this._element.querySelector(".cards-grid__like-counter"),this.likesHTML.textContent=this._likesArr.length,this.isMyLiked(),this._element}_setEventListeners(){this.likeButton.addEventListener("click",(()=>{this._toggleLike()})),this._deleteButton.addEventListener("click",(()=>{this.deleteHandler(this)})),this._image.addEventListener("click",(()=>{this._handleCardImage(this._text,this._link)}))}deleteCard(){this._deleteButton.closest(".cards-grid__item").remove()}updateLikeCounter(){console.log("here"),this.likesHTML.textContent=this._likesArr.length}_toggleLike(){this.isLiked?(this.isLiked=!1,this.dislikeHandler(this)):(this.isLiked=!0,this.likeHandler(this))}}class t{constructor(e,t){this._form=t,this._submitSelector=e.submitSelector,this._inputSelector=e.inputSelector,this._inputSectionSelector=e.inputSectionSelector,this._inputErrorSelector=e.inputErrorSelector,this._inputErrorClass=e.inputErrorClass,this._disabledButtonClass=e.disabledButtonClass}_hiddenError(e){e.innerText="",e.classList.remove(this._inputErrorClass)}_showError(e,t){e.innerText=t,e.classList.add(this._inputErrorClass)}_setInputState(e,t){const s=e.closest(this._inputSectionSelector).querySelector(this._inputErrorSelector);t?this._hiddenError(s):this._showError(s,e.validationMessage)}_toggleInputState(e){const t=e.validity.valid;this._setInputState(e,t)}_enableButton(){this._submitElement.removeAttribute("disabled"),this._submitElement.classList.remove(this._disabledButtonClass)}_disableButton(){this._submitElement.setAttribute("disabled",!0),this._submitElement.classList.add(this._disabledButtonClass)}_toggleButtonState(){this._inputs.every((e=>e.validity.valid))?this._enableButton():this._disableButton()}_setEventListeners(){this._submitElement=this._form.querySelector(this._submitSelector),this._inputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this._toggleInputState(e),this._toggleButtonState()}))})),this._toggleButtonState()}resetInputs(){this._inputs.forEach((e=>{e.value=""}))}_resetErrorsFromInput(e){const t=e.closest(this._inputSectionSelector).querySelector(this._inputErrorSelector);this._hiddenError(t)}resetValidation(){this._toggleButtonState(),this._inputs.forEach((e=>{this._resetErrorsFromInput(e)}))}enableValidation(){this._setEventListeners()}}class s{constructor(e){this._selector=e,this._element=document.querySelector(this._selector),this._buttonClose=this._element.querySelector(".popup__button-close"),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._element.classList.add("popup_active"),document.addEventListener("keydown",this._handleEscClose)}close(){this._element.classList.remove("popup_active"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClick(e){e.target===e.currentTarget&&this.close()}setEventListeners(){this._buttonClose.addEventListener("click",(()=>{this.close()})),this._element.addEventListener("click",(e=>{this._handleOverlayClick(e)}))}}class i extends s{constructor(e){super(e.popupSelector),this._handleFormSubmit=e.handleFormSubmit,this._formSelector=".popup__input",this._inputList=this._element.querySelectorAll(".popup__input-text")}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>this._formValues[e.name]=e.value)),this._formValues}setEventListeners(){this._form=this._element.querySelector(this._formSelector),super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name].trim()}))}close(){this._form.reset(),super.close()}}const r={submitSelector:".popup__button-save",inputSelector:".popup__input-text",inputSectionSelector:".popup__section",inputErrorSelector:".popup__input-error",inputErrorClass:"popup__input-error_active",disabledButtonClass:"popup__button-save_inactive"},n=document.querySelector(".popup__button-save-prof"),o=document.querySelector(".popup__button-save-place"),l=document.querySelector(".popup__button-save-avat");function a(e,t){e==o&&(e.textContent=t?"Рисую карточку":"Coздать"),e!=n&&e!=l||(e.textContent=t?"Сохранение...":"Coхранить")}const h=new class{constructor(e){this._url=e.baseUrl,this._headers=e.headers,this._cohortId="cohort-64"}_checkResponse(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}updateProfileInfo(e){return fetch(`${this._url}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}updateAvatar(e){return fetch(`${this._url}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}getInitialCards(){return fetch(`${this._url}/cards`,{headers:this._headers}).then(this._checkResponse)}postNewCard(e){return fetch(`${this._url}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}takeUserInfo(){return fetch(`${this._url}/users/me`,{method:"GET",headers:this._headers}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._url}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}likeCard(e){return fetch(`${this._url}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}dislikeCard(e){return fetch(`${this._url}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-64",headers:{authorization:"bb51037e-40e9-4ec0-bf4f-63ccb84f68dd","Content-Type":"application/json"}}),c=document.querySelector(".profile"),_=c.querySelector(".profile__edit-button"),u=new class{constructor(e){let{nameSelector:t,infoSelector:s,avatarSelector:i}=e;this._nameHTML=document.querySelector(t),this._infoHTML=document.querySelector(s),this._avatarHtml=document.querySelector(i),this._name=this._nameHTML.textContent.trim(),this._info=this._infoHTML.textContent.trim()}getUserInfo(){return{first:this._name,second:this._info}}setUserInfo(e){this._name=e.name,this._info=e.about,this.id=e._id,this._avatar=e.avatar,this._nameHTML.textContent=this._name,this._infoHTML.textContent=this._info,this._avatarHtml.src=e.avatar}}({nameSelector:".profile__name",infoSelector:".profile__name-subline",avatarSelector:".profile__avatar"}),d=new i({popupSelector:".popup.popup_profile",handleFormSubmit:e=>{var t;t=e,a(n,!0),t.name=t.first,t.about=t.second,delete t.first,delete t.second,h.updateProfileInfo(t).then((e=>{u.setUserInfo(e),d.close()})).catch((e=>console.log(`Ошибка: ${e}`))).finally((()=>a(n,!1)))}});d.setEventListeners(),_.addEventListener("click",(()=>{d.setInputValues(u.getUserInfo()),p.resetValidation(),d.open()}));const p=new t(r,d._form);p.enableValidation();const m=c.querySelector(".profile__avatar-button"),f=new i({popupSelector:".popup.popup_avatar",handleFormSubmit:e=>{var t;t=e,a(l,!0),h.updateAvatar(t.second).then((e=>{u.setUserInfo(e),f.close()})).catch((e=>console.log(`Ошибка: ${e}`))).finally((()=>a(l,!1)))}});f.setEventListeners();const S=new t(r,f._form);S.enableValidation(),m.addEventListener("click",(()=>{S.resetValidation(),f.open()}));const g=document.querySelector(".profile__add-button"),v=(document.querySelector(".cards-grid"),document.getElementById("template-card"),new i({popupSelector:".popup.popup_place",handleFormSubmit:e=>{var t;(t=e).name=t.first,t.link=t.second,delete t.first,delete t.second,a(o,!0),h.postNewCard(t).then((e=>{const t=q(e);x.prependItem(t)})).catch((e=>console.log(`Ошибка: ${e}`))).finally((()=>{v.close(a(o,!1))}))}}));v.setEventListeners(),g.addEventListener("click",(()=>{k.resetValidation(),k.resetInputs(),v.open()}));const k=new t(r,v._form);function E(e){I.open(),I.setConfirmFunction((()=>{h.deleteCard(e.id).then((()=>{e.deleteCard(),I.close()})).catch((e=>console.log(`Ошибка: ${e}`)))}))}function b(e){h.likeCard(e.id).then((t=>{e.likesHTML.textContent=t.likes.length,e.likeButton.classList.toggle("cards-grid__like-button_active")})).catch((e=>(console.log(`Ошибка: ${e}`),[])))}function L(e){h.dislikeCard(e.id).then((t=>{e.likesHTML.textContent=t.likes.length,e.likeButton.classList.toggle("cards-grid__like-button_active")})).catch((e=>(console.log(`Ошибка: ${e}`),[])))}k.enableValidation();const C=new class extends s{constructor(e){super(e),this._image=this._element.querySelector(".popup__huge-image"),this._imageText=this._element.querySelector(".popup__image-text")}open(e){let{src:t,alt:s}=e;this._image.src=t,this._image.alt=s,this._imageText.textContent=s,super.open()}}(".popup.popup_image");function y(e,t){C.open({src:t,alt:e})}C.setEventListeners();const I=new class extends s{constructor(e){let{popupSelector:t}=e;super(t),this._formSelector=".popup__input"}setConfirmFunction(e){this._handleFormSubmit=e}setEventListeners(){this._form=this._element.querySelector(this._formSelector),super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit()}))}close(){this._form.reset(),super.close()}}({popupSelector:".popup.popup_delCard"});function q(t){return new e(t,"template-card",y,b,L,E,u.id).generateCard()}I.setEventListeners();const x=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>this._renderer(e)))}prependItem(e){this._container.prepend(e)}setItem(e){this._container.append(e)}}({renderer:e=>{const t=q(e);x.setItem(t)}},".cards-grid");Promise.all([h.takeUserInfo(),h.getInitialCards()]).then((e=>{let[t,s]=e;u.setUserInfo(t),x.renderItems(s)})).catch((e=>console.log(`Ошибка: ${e}`)))})();
(()=>{"use strict";class e{constructor(e,t,s){this._text=e.name,this._link=e.link,this._templateSelector=t,this._handleCardImage=s}_getTemplate(){return document.getElementById(this._templateSelector).content.cloneNode(!0)}generateCard(){return this._element=this._getTemplate(),this._image=this._element.querySelector(".cards-grid__image"),this._image.src=this._link,this._image.alt=this._text,this._element.querySelector(".cards-grid__text").textContent=this._text,this._likeButton=this._element.querySelector(".cards-grid__like-button"),this._deleteButton=this._element.querySelector(".cards-grid__trash-button"),this._setEventListeners(),this._element}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._toggleLike()})),this._deleteButton.addEventListener("click",(()=>{this._deleteCard()})),this._image.addEventListener("click",(()=>{this._handleCardImage(this._text,this._link)}))}_deleteCard(){this._deleteButton.closest(".cards-grid__item").remove()}_toggleLike(){this._likeButton.classList.toggle("cards-grid__like-button_active")}}class t{constructor(e,t){this._form=t,this._submitSelector=e.submitSelector,this._inputSelector=e.inputSelector,this._inputSectionSelector=e.inputSectionSelector,this._inputErrorSelector=e.inputErrorSelector,this._inputErrorClass=e.inputErrorClass,this._disabledButtonClass=e.disabledButtonClass}_hiddenError(e){e.innerText="",e.classList.remove(this._inputErrorClass)}_showError(e,t){e.innerText=t,e.classList.add(this._inputErrorClass)}_setInputState(e,t){const s=e.closest(this._inputSectionSelector).querySelector(this._inputErrorSelector);t?this._hiddenError(s):this._showError(s,e.validationMessage)}_toggleInputState(e){const t=e.validity.valid;this._setInputState(e,t)}_enableButton(){this._submitElement.removeAttribute("disabled"),this._submitElement.classList.remove(this._disabledButtonClass)}_disableButton(){this._submitElement.setAttribute("disabled",!0),this._submitElement.classList.add(this._disabledButtonClass)}_toggleButtonState(){this._inputs.every((e=>e.validity.valid))?this._enableButton():this._disableButton()}_setEventListeners(){this._submitElement=this._form.querySelector(this._submitSelector),this._inputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this._toggleInputState(e),this._toggleButtonState()}))})),this._toggleButtonState()}resetInputs(){this._inputs.forEach((e=>{e.value=""}))}_resetErrorsFromInput(e){const t=e.closest(this._inputSectionSelector).querySelector(this._inputErrorSelector);this._hiddenError(t)}resetValidation(){this._toggleButtonState(),this._inputs.forEach((e=>{this._resetErrorsFromInput(e)}))}enableValidation(){this._setEventListeners()}}class s{constructor(e){this._selector=e,this._element=document.querySelector(this._selector),this._buttonClose=this._element.querySelector(".popup__button-close")}open(){this._element.classList.add("popup_active"),document.addEventListener("keydown",(()=>{this._handleEscClose}))}close(){this._element.classList.remove("popup_active"),document.removeEventListener("keydown",(()=>{this._handleEscClose}))}_handleEscClose(e){"Escape"===e.key&&(document.querySelector(".popup_active"),this.close())}_handleOverlayClick(e){e.target===e.currentTarget&&this.close()}setEventListeners(){this._buttonClose.addEventListener("click",(()=>{this.close()})),document.addEventListener("keydown",(e=>{this._handleEscClose(e)})),this._element.addEventListener("click",(e=>{this._handleOverlayClick(e)}))}generate(){return this._element=this._getElement(),this._setEventListeners(),this._element}}class i extends s{constructor(e,t){let{src:s,alt:i}=t;super(e),this._image=this._element.querySelector(".popup__huge-image"),this._imageText=this._element.querySelector(".popup__image-text"),this._src=s,this._alt=i}open(){this._image.src=this._src,this._image.alt=this._alt,this._imageText.textContent=this._alt,super.open()}}class n extends s{constructor(e){let{popupSelector:t,handleFormSubmit:s}=e;super(t),this._handleFormSubmit=s,this._formSelector=".popup__input"}_getInputValues(){return this._inputList=this._element.querySelectorAll(".popup__input-text"),this._formValues={},this._inputList.forEach((e=>this._formValues[e.name]=e.value)),this._formValues}setEventListeners(){this._form=this._element.querySelector(this._formSelector),super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}setInitUserInfo(e){this._form.querySelector('input[name = "first"]').value=e.name.trim(),this._form.querySelector('input[name = "second"]').value=e.info.trim()}close(){this._form.reset(),super.close()}}const r=document.querySelector(".profile").querySelector(".profile__edit-button"),o=new class{constructor(e){let{nameSelector:t,infoSelector:s}=e;this._nameHTML=document.querySelector(t),this._infoHTML=document.querySelector(s),this._name=this._nameHTML.textContent.trim(),this._info=this._infoHTML.textContent.trim()}getUserInfo(){return{name:this._name,info:this._info}}setUserInfo(e){this._name=e.first,this._info=e.second,this._nameHTML.textContent=this._name,this._infoHTML.textContent=this._info}}({nameSelector:".profile__name",infoSelector:".profile__name-subline"}),l=new n({popupSelector:".popup.popup_profile",handleFormSubmit:e=>{var t;t=e,o.setUserInfo(t),l.close()}});l.setEventListeners(),r.addEventListener("click",(()=>{l.setInitUserInfo(o.getUserInfo()),_.resetValidation(),l.open()}));const a={submitSelector:".popup__button-save",inputSelector:".popup__input-text",inputSectionSelector:".popup__section",inputErrorSelector:".popup__input-error",inputErrorClass:"popup__input-error_active",disabledButtonClass:"popup__button-save_inactive"},_=new t(a,l._form);_.enableValidation();const c=document.querySelector(".profile__add-button"),u=(document.querySelector(".cards-grid"),document.getElementById("template-card"),new n({popupSelector:".popup.popup_place",handleFormSubmit:e=>{!function(e){const t=e.first,s=e.second;if(t&&s){const e=p({name:t,link:s});m.setItem(e),u._form.reset(),u.close()}}(e)}}));u.setEventListeners(),c.addEventListener("click",(()=>{h.resetValidation(),h.resetInputs(),u.open()}));const h=new t(a,u._form);function d(e,t){const s=new i(".popup.popup_image",{src:t,alt:e});s.setEventListeners(),s.open()}function p(t){return new e(t,"template-card",d).generateCard()}h.enableValidation();const m=new class{constructor(e,t){let{data:s,renderer:i}=e;this._renderedItems=s,this._renderer=i,this._container=document.querySelector(t)}renderItems(){this._renderedItems.forEach((e=>this._renderer(e)))}setItem(e){this._container.append(e)}}({data:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{const t=p(e);m.setItem(t)}},".cards-grid");m.renderItems()})();